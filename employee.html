<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .employee-card {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .employee-card img {
            height: 180px;
            width: 100%;
            object-fit: cover;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    

<div class="container mt-4">
    <h2>Employee Management</h2>
    <button id="addEmployeeBtn" class="btn btn-success mb-3">Add Employee</button>
    <button id="toggleView" class="btn btn-primary mb-3">Toggle View</button>
    
    <div id="cardView" class="row"></div>
    <table id="tableView" class="table table-striped d-none">
        <thead>
            <tr>
                <th>Name</th><th>Email</th><th>Phone</th><th>Department</th><th>Position</th><th>Address</th><th>Country</th><th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Add/Edit Employee Modal -->
<div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Employee Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="employeeForm">
                    <input type="hidden" id="userId">
                    <div class="mb-3">
                        <label>Profile Picture URL:</label>
                        <input type="text" id="profilePicture" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label>Name:</label>
                        <input type="text" id="fullName" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label>Email:</label>
                        <input type="email" id="email" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label>Phone:</label>
                        <input type="text" id="phone" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label>Department:</label>
                        <input type="text" id="department" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label>Position:</label>
                        <input type="text" id="position" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label>Address:</label>
                        <input type="text" id="address" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label>Country:</label>
                        <input type="text" id="country" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    function fetchEmployees() {
        $.get("http://localhost:3000/employees", function(employees) {
            $("#cardView, #tableView tbody").empty();
            
            employees.forEach(emp => {
                $("#cardView").append(`
                    <div class="col-md-4 d-flex">
                        <div class="card employee-card p-3 mb-3 w-100">
                            <img src="${emp.profile_picture || 'default.jpg'}" class="card-img-top" alt="Profile Picture">
                            <div class="card-body">
                                <h5 class="card-title">${emp.full_name}</h5>
                                <p class="card-text"><strong>Email:</strong> ${emp.email}</p>
                                <p class="card-text"><strong>Department:</strong> ${emp.department}</p>
                                <p class="card-text"><strong>Position:</strong> ${emp.position}</p>
                                <p class="card-text"><strong>Address:</strong> ${emp.address || "N/A"}</p>
                                <p class="card-text"><strong>Country:</strong> ${emp.country || "N/A"}</p>
                                <div class="card-buttons">
                                    <button onclick="editEmployee(${emp.user_id})" class="btn btn-warning btn-sm">Edit</button>
                                    <button onclick="deleteEmployee(${emp.user_id})" class="btn btn-danger btn-sm">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `);

                $("#tableView tbody").append(`
                    <tr>
                        <td>${emp.full_name}</td>
                        <td>${emp.email}</td>
                        <td>${emp.phone}</td>
                        <td>${emp.department}</td>
                        <td>${emp.position}</td>
                        <td>${emp.address || "N/A"}</td>
                        <td>${emp.country || "N/A"}</td>
                        <td>
                            <button onclick="editEmployee(${emp.user_id})" class="btn btn-warning btn-sm">Edit</button>
                            <button onclick="deleteEmployee(${emp.user_id})" class="btn btn-danger btn-sm">Delete</button>
                        </td>
                    </tr>
                `);
            });
        });
    }

    fetchEmployees();

    $("#toggleView").click(function() {
        $("#cardView, #tableView").toggleClass("d-none");
    });

    $("#addEmployeeBtn").click(function() {
        $("#userId").val("");
        $("#employeeForm")[0].reset();
        $("#employeeModal").modal("show");
    });

    function editEmployee(user_id) {
        $.get(`http://localhost:3000/employees/${user_id}`, function(emp) {
            $("#userId").val(emp.user_id);
            $("#profilePicture").val(emp.profile_picture);
            $("#fullName").val(emp.full_name);
            $("#email").val(emp.email);
            $("#phone").val(emp.phone);
            $("#department").val(emp.department);
            $("#position").val(emp.position);
            $("#address").val(emp.address);
            $("#country").val(emp.country);
            $("#employeeModal").modal("show");
        });
    }

    $("#employeeForm").submit(function(event) {
        event.preventDefault();
        const user_id = $("#userId").val();
        const employeeData = {
            profile_picture: $("#profilePicture").val(),
            full_name: $("#fullName").val(),
            email: $("#email").val(),
            phone: $("#phone").val(),
            department: $("#department").val(),
            position: $("#position").val(),
            address: $("#address").val(),
            country: $("#country").val()
        };

        $.ajax({
            url: `http://localhost:3000/employees${user_id ? "/" + user_id : ""}`,
            type: user_id ? "PUT" : "POST",
            contentType: "application/json",
            data: JSON.stringify(employeeData),
            success: function() {
                $("#employeeModal").modal("hide");
                fetchEmployees();
            }
        });
    });

    function deleteEmployee(user_id) {
        if (confirm("Are you sure?")) {
            $.ajax({ url: `http://localhost:3000/employees/${user_id}`, type: "DELETE", success: fetchEmployees });
        }
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
