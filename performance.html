<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Performance</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        .table th {
            background-color: #007bff;
            color: white;
            text-align: center;
        }
        .table td {
            text-align: center;
        }
        .star-rating {
            font-size: 20px;
            color: gold;
            cursor: pointer;
        }
        .btn-save {
            background-color: #28a745;
            color: white;
        }
    </style>
</head>
<body class="container mt-4">
    <h2>Employee Performance</h2>
    <table class="table table-bordered text-center">
        <thead class="table-dark">
            <tr>
                <th>User ID</th>
                <th>Full Name</th>
                <th>Department</th>
                <th>Position</th>
                <th>Tasks Completed</th>
                <th>Rating</th>
                <th>Review</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="performanceTable">
            <!-- Data will be inserted here dynamically -->
        </tbody>
    </table>

    <script>
        async function loadEmployees() {
            try {
                const response = await axios.get("http://localhost:3000/employees");
                const employees = response.data;
                let tableHTML = "";

                employees.forEach(emp => {
                    tableHTML += `
                        <tr>
                            <td>${emp.user_id}</td>
                            <td>${emp.full_name}</td>
                            <td>${emp.department}</td>
                            <td>${emp.position}</td>
                            <td><input type="text" id="tasks-${emp.user_id}" class="form-control"></td>
                            <td>
                                <select id="rating-${emp.user_id}" class="form-control">
                                    ${[1, 2, 3, 4, 5].map(r => `<option value="${r}">${"‚≠ê".repeat(r)}</option>`).join('')}
                                </select>
                            </td>
                            <td><textarea id="review-${emp.user_id}" class="form-control"></textarea></td>
                            <td><button class="btn btn-success btn-save" onclick="savePerformance('${emp.user_id}', '${emp.full_name}', '${emp.department}', '${emp.position}')">Save</button></td>
                        </tr>
                    `;
                });

                document.getElementById("performanceTable").innerHTML = tableHTML;
            } catch (error) {
                console.error("Error fetching employee data:", error);
            }
        }

      
        async function savePerformance(user_id, full_name, department, position) {
    const tasksCompleted = document.getElementById(`tasks-${user_id}`).value;
    const rating = document.getElementById(`rating-${user_id}`).value;
    const review = document.getElementById(`review-${user_id}`).value;

    console.log("üîº Sending Data:", { user_id, full_name, department, position, tasksCompleted, rating, review });

    try {
        const response = await axios.post("http://localhost:4000/update_performance", {
            user_id, full_name, department, position, tasks_completed: tasksCompleted, rating, review
        });

        console.log("‚úÖ Server Response:", response.data);
        alert("Performance saved!");
    } catch (error) {
        console.error("‚ùå Error saving performance:", error.response ? error.response.data : error.message);
        alert("Error saving performance: " + (error.response ? error.response.data.message : "Unknown error"));
    }
}



        loadEmployees();
    </script>
</body>
</html>
