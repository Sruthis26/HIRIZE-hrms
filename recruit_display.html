<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Listings</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetchJobs();
        });

        function fetchJobs() {
            fetch("http://localhost:3000/getjobs")
                .then(response => response.json())
                .then(jobs => {
                    console.log("Fetched Jobs:", jobs); // Debugging
                    let tableBody = document.getElementById("jobTableBody");
                    let cardContainer = document.getElementById("cardView");

                    tableBody.innerHTML = "";
                    cardContainer.innerHTML = "";

                    if (jobs.length === 0) {
                        tableBody.innerHTML = "<tr><td colspan='5'>No jobs available</td></tr>";
                        return;
                    }

                    jobs.forEach(job => {
                        tableBody.innerHTML += `
                            <tr>
                                <td>${job.jobposition}</td>
                                <td>${job.maxapplicants}</td>
                                <td>${job.accessibletill}</td>
                                <td>${job.eligibilitycriteria}</td>
                                <td><button class="btn btn-success" onclick="openApplyForm('${job.jobposition}')">Apply</button></td>
                            </tr>
                        `;

                        cardContainer.innerHTML += `
                            <div class="col-md-4">
                                <div class="card mb-3 p-3 shadow">
                                    <h5>${job.jobposition}</h5>
                                    <p><strong>Max Applicants:</strong> ${job.maxapplicants}</p>
                                    <p><strong>Accessible Till:</strong> ${job.accessibletill}</p>
                                    <p><strong>Eligibility:</strong> ${job.eligibilitycriteria}</p>
                                    <button class="btn btn-primary" onclick="openApplyForm('${job.jobposition}')">Apply</button>
                                </div>
                            </div>
                        `;
                    });
                })
                .catch(error => console.error("Error fetching jobs:", error));
        }

        function openApplyForm(jobPosition) {
            document.getElementById("applyJobPosition").value = jobPosition;
            document.getElementById("applyModal").style.display = "block";
        }

        function submitApplication() {
            let jobPosition = document.getElementById("applyJobPosition").value;
            let fullName = document.getElementById("applyFullName").value;
            let email = document.getElementById("applyEmail").value;
            let phone = document.getElementById("applyPhone").value;
            let cv = document.getElementById("applyCV").files[0];
            let resume = document.getElementById("applyResume").files[0];

            if (!fullName || !email || !phone || !cv || !resume) {
                alert("Please fill all fields and upload both CV and Resume.");
                return;
            }

            let formData = new FormData();
            formData.append("jobPosition", jobPosition);
            formData.append("fullName", fullName);
            formData.append("email", email);
            formData.append("phone", phone);
            formData.append("cv", cv);
            formData.append("resume", resume);

            fetch("http://localhost:3000/applyjob", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                document.getElementById("applyForm").reset();
                document.getElementById("applyModal").style.display = "none";
            })
            .catch(error => console.error("Error submitting application:", error));
        }
    </script>
</head>
<body>

    <div class="container mt-5">
        <h2 class="mb-4">Available Jobs</h2>

        <button class="btn btn-secondary mb-3" onclick="toggleView()">Toggle View</button>

        <div id="tableView" style="display: none;">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Job Position</th>
                        <th>Max Applicants</th>
                        <th>Accessible Till</th>
                        <th>Eligibility Criteria</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="jobTableBody"></tbody>
            </table>
        </div>

        <div id="cardView" class="row"></div>
    </div>

    <!-- Apply Job Modal -->
    <div id="applyModal" class="modal" style="display: none; position: fixed; top: 20%; left: 50%; transform: translate(-50%, 0); background: white; padding: 20px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);">
        <h4>Apply for Job</h4>
        <form id="applyForm">
            <div class="mb-3">
                <label>Job Position</label>
                <input type="text" class="form-control" id="applyJobPosition" readonly>
            </div>
            <div class="mb-3">
                <label>Full Name</label>
                <input type="text" class="form-control" id="applyFullName" required>
            </div>
            <div class="mb-3">
                <label>Email</label>
                <input type="email" class="form-control" id="applyEmail" required>
            </div>
            <div class="mb-3">
                <label>Phone</label>
                <input type="tel" class="form-control" id="applyPhone" required>
            </div>
            <div class="mb-3">
                <label>Upload CV</label>
                <input type="file" class="form-control" id="applyCV" required>
            </div>
            <div class="mb-3">
                <label>Upload Resume</label>
                <input type="file" class="form-control" id="applyResume" required>
            </div>
            <button type="button" class="btn btn-success" onclick="submitApplication()">Submit</button>
            <button type="button" class="btn btn-danger" onclick="document.getElementById('applyModal').style.display='none'">Close</button>
        </form>
    </div>

    <script>
        function toggleView() {
            let tableView = document.getElementById("tableView");
            let cardView = document.getElementById("cardView");

            if (tableView.style.display === "none") {
                tableView.style.display = "block";
                cardView.style.display = "none";
            } else {
                tableView.style.display = "none";
                cardView.style.display = "flex";
            }
        }
        function fetchJobs() {
    fetch("http://localhost:3000/getjobs")
        .then(response => response.json())
        .then(jobs => {
            console.log("Fetched Jobs:", jobs); // Debugging

            let tableBody = document.getElementById("jobTableBody");
            let cardContainer = document.getElementById("cardView");

            tableBody.innerHTML = "";
            cardContainer.innerHTML = "";

            if (jobs.length === 0) {
                tableBody.innerHTML = "<tr><td colspan='5'>No jobs available</td></tr>";
                return;
            }

            jobs.forEach(job => {
                console.log(job); // Check actual object properties

                tableBody.innerHTML += `
                    <tr>
                        <td>${job.job_position || job.jobposition}</td>
                        <td>${job.max_applicants || job.maxapplicants}</td>
                        <td>${job.accessible_till || job.accessibletill}</td>
                        <td>${job.eligibility_criteria || job.eligibilitycriteria}</td>
                        <td><button class="btn btn-success" onclick="openApplyForm('${job.job_position || job.jobposition}')">Apply</button></td>
                    </tr>
                `;

                cardContainer.innerHTML += `
                    <div class="col-md-4">
                        <div class="card mb-3 p-3 shadow">
                            <h5>${job.job_position || job.jobposition}</h5>
                            <p><strong>Max Applicants:</strong> ${job.max_applicants || job.maxapplicants}</p>
                            <p><strong>Accessible Till:</strong> ${job.accessible_till || job.accessibletill}</p>
                            <p><strong>Eligibility:</strong> ${job.eligibility_criteria || job.eligibilitycriteria}</p>
                            <button class="btn btn-primary" onclick="openApplyForm('${job.job_position || job.jobposition}')">Apply</button>
                        </div>
                    </div>
                `;
            });
        })
        .catch(error => console.error("Error fetching jobs:", error));
}
function submitApplication() {
    let jobPosition = document.getElementById("applyJobPosition").value;
    let fullName = document.getElementById("applyFullName").value;
    let email = document.getElementById("applyEmail").value;
    let phone = document.getElementById("applyPhone").value;
    let cv = document.getElementById("applyCV").files[0];
    let resume = document.getElementById("applyResume").files[0];

    if (!fullName || !email || !phone || !cv || !resume) {
        alert("Please fill all fields and upload both CV and Resume.");
        return;
    }

    let formData = new FormData();
    formData.append("jobPosition", jobPosition);
    formData.append("fullName", fullName);
    formData.append("email", email);
    formData.append("phone", phone);
    formData.append("cv", cv);
    formData.append("resume", resume);

    console.log("Submitting Application:", [...formData]);

    fetch("http://localhost:4000/applyjob", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log("Server Response:", data);
        if (data.success) {
            alert("Application submitted successfully!");
            document.getElementById("applyForm").reset();
        } else {
            alert("Error: " + data.message);
        }
    })
    .catch(error => console.error("Error submitting application:", error));
}

    </script>

</body>
</html>
